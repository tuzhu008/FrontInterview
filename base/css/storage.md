# 存储


## Cookie

HTTP 协议本身是无状态的。什么是无状态呢，即服务器无法判断用户身份。Cookie 实际上是一小段的 key-value 格式的文本信息。客户端向服务器发起请求，如果服务器需要记录该用户状态，就使用 `response` 向客户端浏览器颁发一个 Cookie。客户端浏览器会把 Cookie 保存起来。当浏览器再请求该网站时，浏览器把请求的网址连同该 Cookie 一同提交给服务器。服务器检查该 Cookie，以此来辨认用户状态。

优点：

* 数据持久性
* 不需要任何服务器资源，因为 Cookie 是存储在客户端并发送给服务器读取
* 可配置到期规则，控制 Cookie 的生命周期，使之不会永远有效，偷盗者可能拿到的是一个过期的 Cookie
* 简单性，基于文件的轻量结构
* 通过良好的编程，控制保存在 Cookie 中的 Session 对象的大小
* 通过加密和安全传输技术（ssl），减少 Cookie 被破解的可能性
* 只要cookie中不存放敏感的数据，即使被盗也不会有重大损失

缺点：

* Cookie 的数量和长度都有限制

  * IE6 及以下的版本最多20个

  * IE7 以后的可以有50个

  * Firefox 可以有50个

  * chrome 和 Safari 没有限制

  * 每个 cookie 的长度不超过4k，否则会被截掉

* 潜在的安全风险：

  * 明文存储，可修改，易被截取篡改，如果 cookie 被拦截，就可能会获取到所有的 Session 信息
  * 服务器如果未设置 `http-only` 时，客户端可以使用 JS 对其进行访问，进而可以修改。

* 受限于用户配置，有的用户禁用了浏览器或者客户端设备接受 cookie 的能力，因此限制了这一功能

* 使用场景有限：例如，有些状态不可能保存在客户端，为了防止重复提交表达，需要在服务器端保存一个计时器，如果把这个计时器保存在客户端，它将不起作用。

* 增加网络开销：由于每次都会随请求一起发送到服务器，一些不必要的信息也会一起发送，造成带宽的浪费。

## 本地存储

### Cookie

### localStorage

用于持久化的本地存储，除非主动删除数据，否则数据永远不会过期。

访问 localStorage 具有同源策略。

优点：

* 容量大，可以达到 5M
* 易用，强大，原生支持

缺点：

* 兼容性差，高级版本的浏览器才支持，这点其实可以忽略，目前业界支持最低的 ie8 已经支持

  ![](/assets/localStorage浏览器兼容性.png)

* 存储内容类型限制：只能为 String 类型

* 隐私模式下不可读取：可读写，但不可永远保存；正常模式和隐私模式是隔离的，隐私模式无法访问正常模式存储的东西；。

* 不能被爬虫提取

### sessionStorage

用于本地存储一个会话中的数据，这些数据只有在同一个会话中的页面才能访问，会话结束后数据随之销毁。sessionStorage 不是一种持久化的本地存储，仅仅是会话级别的存储。

访问 sessionStorage 具有同源策略。

### localStorage与sessionStroage区别

* localStroage 是将信息存储在硬件设备中的，关闭浏览器或网页也不会消失；
* sessionStroage 有效期只是网页在浏览器打开到关闭的时间段

### IndexedDB

IndexedDB 是一种低级 API，用于客户端存储大量结构化数据\(包括, 文件/ blobs\)。该 API 使用索引来实现对该数据的高性能搜索。

IndexedDB 是一个事务型数据库系统，是一个基于 JavaScript 的面向对象的数据库。IndexedDB 允许您存储和检索用键索引的对象；可以存储结构化克隆算法支持的任何对象。

优点：

* 存储内容类型多样
* 可以存储大量数据

缺点:

* 兼容性差，IE10


### WebSQL

WebSQL 是前端的一个独立模块，是 web 存储方式的一种。

WebSQL 是一个在浏览器客户端的结构关系数据库，这是浏览器内的本地RDBMS\(关系型数据库系统\)，你可以使用 SQL 查询

缺点：

* 兼容性差，当前只有谷歌支持，ie 和火狐均不支持。