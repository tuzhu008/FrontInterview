# 重绘和重排

重绘：Repaint

重排：Reflow

## 重绘

布局没有发生改变，改变那些不会影响元素在网页中的位置的元素样式时，譬如 `background-color` \(背景色\)， `border-color` \(边框色\)， `visibility` \(可见性\)，浏览器只会用新的样式将元素重绘一次\(这就是重绘，或者说重新构造样式\)

## 重排

当DOM变化影响了元素的几何属性（宽、高改变等等），浏览器此时需要重新计算元素几何属性，并且页面中其他元素的几何属性可能会受影响这样渲染树就发生了改变，也就是重新构造RenderTree渲染树

触发重排的情况：

**（1）页面初始渲染**

**（2）DOM操作（元素添加、删除、修改或者元素顺序的改变）**

**（3）改变元素位置，改变元素尺寸（宽、高、内外边距、边框等），改变元素内容（文本或图片等）**

**（4）浏览器窗口的操作（缩放，滚动）**

**（5）添加或删除样式表**

**（6）更改“类”的属性**

**（7）伪类激活（悬停）**

## 优化：

* **减少重绘和重排**

  （1）不要一条一条地修改 DOM 的样式。预先定义好 css 的 class，然后修改 DOM 的 className。

  （2）不要把 DOM 结点的属性值放在一个循环里当成循环里的变量。

  （3）为动画的 HTML 元件使用 fixed 或 absoult 的 position，那么修改他们的 CSS 是不会 reflow 的。

  （4）千万不要使用 table 布局。因为可能很小的一个小改动会造成整个 table 的重新布局。

* **编写CSS注意事项**

  CSS 选择符是从右到左进行匹配的，切记！所以，`#nav li` 我们以为这是一条很简单的规则，秒秒钟就能匹配到想要的元素，但是，是从右往左匹配啊，所以，会去找所有的 `li`，然后再去确定它的父元素是不是 `#nav`。，因此，写 css 的时候需要注意：

  （1）dom 深度尽量浅。

  （2） 减少 inline javascript、css 的数量。使用现代合法的 css 属性。

  （3） 不要为 id 选择器指定类名或是标签，因为id可以唯一确定一个元素。

  （4）避免后代选择符，尽量使用子选择符。原因：子元素匹配符的概率要大于后代元素匹配符。后代选择符; `#tp p{} `子选择符：`#tp>p{}`

  （51） 避免使用通配符，举一个例子，.mod .hd \*{font-size:14px;} 根据匹配顺序,将首先匹配通配符,也就是说先匹配出通配符,然后匹配.hd（就是要对dom树上的所有节点进行遍历他的父级元素）,然后匹配.mod,这样的性能耗费可想而知.

* **Script标签的位置**

  （1）将所有的script标签放到页面底部，也就是body闭合标签之前，这能确保在脚本执行前页面已经完成了DOM树渲染。

  （2）尽可能地合并脚本。页面中的script标签越少，加载也就越快，响应也越迅速。无论是外链脚本还是内嵌脚本都是如此。

  （3）采用无阻塞下载 JavaScript 脚本的方法：

  * 使用script标签的 defer 属性（仅适用于 IE 和 Firefox 3.5 以上版本）；

  * 使用动态创建的script元素来下载并执行代码；

  \(4\) 减少http请求的次数



