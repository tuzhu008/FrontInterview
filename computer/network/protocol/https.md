# HTTPS

https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html

HTTPS 握手的五个阶段：

1. 客户端向服务器发送支持的SSL/TSL的协议版本号，以及客户端支持的加密方法，和一个客户端生成的随机数
1. 服务器确认协议版本和加密方法，向客户端发送一个由服务器生成的随机数，以及数字证书
1. 客户端验证证书是否有效，有效则从数字证书中取出公钥，生成一个随机数，然后用公钥加密这个随机数，发给服务器
1. 服务器用私钥解密，获取发来的随机数
1. 客户端和服务器根据约定好的加密方法，使用前面生成的三个随机数，生成对话密钥，用来加密接下来的整个对话过程

## HTTPS和HTTP的主要区别

* HTTPS 中启用了加密层，而 HTTP 中没有加密层。
* 数据在 HTTPS 中受到保护，而在 HTTP 中则不受保护。
* 当使用 HTTPS 时，网站在 Google 中的排名会提高，而使用 HTTP 时，不会获得任何排名提升。
* 使用 HTTPS 可以防止网络钓鱼，而使用 HTTP 没有保护。
* 使用 HTTPS 符合支付行业规定，但是 HTTP 不合规。
* 在最初几秒钟内加载 HTTPS 可能比加载HTTP慢。
* 获得 SSL 证书可能需要花钱，而 HTTP 没有认证成本。
* 在 Chrome 上使用 HTTPS 网站更方便，使用 HTTP 网站会经常收到不安全提示

## 可以一次性发送多个 HTTP 请求吗？

在 HTTP/1.1 协议中存在一个问题：*单个 TCP 连接在一个时刻只能处理一个请求*。

也就是说你一个请求处理完了才能处理下一个请求。

这就要看看 Pipelining 了，所谓 pipe 就是管道，而 Pipelining 是 HTTP/1.1 规范中的字段，意为 HTTP 流水线（英语：HTTP pipelining）。

它能将多个 HTTP 请求整批提交，在发送过程中不需先等待服务器的回应。

但唯一的问题在于，这个东西在浏览器中是默认关闭的。

因为该技术存在很多问题：

* 一些代理服务器不能正确的处理 HTTP Pipelining；
* 正确的流水线实现是复杂的；
* Head-of-line Blocking 连接头阻塞：在建立起一个 TCP 连接之后，假设客户端在这个连接连续向服务器发送了几个请求。按照标准，服务器应该按照收到请求的顺序返回结果，假设服务器在处理首个请求时花费了大量时间，那么后面所有的请求都需要等着首个请求结束才能响应。

但是，HTTP2 提供了 `Multiplexing` 多路传输特性，让我们可以在一个 TCP 连接中同时完成多个 HTTP 请求。

所以，在 HTTP/1.1 时代，浏览器提高页面加载效率的方法主要有下面两种：

* 维持和服务器已经建立的 TCP 连接，在同一连接上顺序处理多个请求；
* 和服务器建立多个 TCP 连接。

## 浏览器对同一 host 的 TCP 连接上限

假设我们还处在 HTTP/1.1 时代，那个时候没有多路传输。

当浏览器拿到一个有几十张图片的网页该怎么办呢？

肯定不能只开一个 TCP 连接顺序下载，那样用户肯定等的很难受。但是如果每个图片都开一个 TCP 连接发 HTTP 请求，那电脑或者服务器都可能受不了——要是有 1000 张图片的话总不能开 1000 个 TCP 连接吧。

所以浏览器允许我们对同一 host 开启多个 TCP 连接，每个浏览器的数量是不一样的。Chrome 最多允许对同一个 Host 建立六个 TCP 连接。

如果图片都是 HTTPS 连接并且在同一个域名下，那么浏览器在 SSL 握手之后会和服务器商量能不能用 HTTP2，如果能的话就使用 Multiplexing 功能在这个连接上进行多路传输。

不过也未必会所有挂在这个域名的资源都会使用一个 TCP 连接去获取，但是可以确定的是 Multiplexing 很可能会被用到。

如果发现用不了 HTTP2 呢？或者用不了 HTTPS（现实中的 HTTP2 都是在 HTTPS 上实现的，所以也就是只能使用 HTTP/1.1）呢？

那浏览器就会在一个 HOST 上建立多个 TCP 连接，连接数量的最大限制取决于浏览器设置。这些连接会在空闲的时候被浏览器用来发送新的请求。

## 先进行 TCP 握手还是 TLS 握手呢？

一般情况下，不管 TLS 握手次数如何，都得先经过 TCP 三次握手后才能进行，因为 HTTPS 都是基于 TCP 传输协议实现的，得先建立完可靠的 TCP 连接才能做 TLS 握手的事情。

> HTTPS 中的 TLS 握手过程可以同时进行三次握手

这个场景是可能发生的，但是需要在特定的条件下才可能发生，如果没有说任何前提条件，说这句话就是在耍流氓。

那到底什么条件下，这个场景才能发生呢？需要下面这两个条件同时满足才可以：

* 客户端和服务端都开启了 TCP Fast Open 功能，且 TLS 版本是 1.3；
* 客户端和服务端已经完成过一次通信。

[参考](https://zhuanlan.zhihu.com/p/399105434)

## CA、SSL、TLS

SSL（Secure Socket Layer）是指安全套接字层，简而言之，它是一项标准技术，可确保互联网连接安全，保护两个系统之间发送的任何敏感数据，防止网络犯罪分子读取和修改任何传输信息，包括个人资料。

TLS（Transport Layer Security，传输层安全）是更为安全的升级版 SSL。


## 
https://cloud.tencent.com/developer/article/1879758