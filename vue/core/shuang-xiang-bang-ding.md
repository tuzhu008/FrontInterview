# 双向绑定的原理

双向绑定有两个数据流：

* 数据更新的时候更新视图

* 视图更新的时候更新数据

所以其核心在于，如何监听数据更新以及如何监听视图更新。

监听视图更新依赖浏览器的 Dom 事件进行监听；而监听数据更新则是通过数据劫持的方式。

数据劫持后需要通知使用到了这些数据地方进行视图的更新，这里采用发布-订阅模式来实现这一能力。

因此，可以简单地认为 Vue 数据双向绑定原理是通过：数据劫持 + 发布者-订阅者模式 的方式来实现的。

Vue首先劫持（监听）各属性的 getter、setter，并在当监听的属性发生变动时通知订阅者，是否需要更新，若更新就会执行对应的更新函数。
在劫持 getter 时添加订阅，在劫持 setter 的时候进行发布通知。

常见的基于数据劫持的双向绑定有两种实现:

* `Object.defineProperty`。Vue2.0 使用。

* `Proxy`。ES2015 新特性，在 Vue3.0 版本开始使用 `Proxy` 代替 `Object.defineProperty`。


## 源码解析

* 创建 vm
* 编译
* 遇到 `v-model`、`{{name}}` 等双向绑定的模板语法，创建劫持、收集依赖
* 数据或视图更新时遍历依赖表，调用其更新方法。